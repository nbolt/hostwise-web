- headers = ['Booking ID', 'Property ID', 'Booking Status', 'Linen Type', 'Net Sale', 'Gross Sale', 'Adjusted Cost', 'Cleaning Cost', 'Linen Cost', 'Toiletries Cost', 'Pool Cost', 'Patio Cost', 'Windows Cost', 'Staging Cost', 'Late Next Day Cost', 'Late Same Day Cost', 'No Access Fee Cost', 'Extra King Sets Cost', 'Extra Twin Sets Cost', 'Extra Toiletries Cost', 'First Booking Discount Cost', 'Coupon Cost', 'Payment Status', 'Email', 'userID', 'date', 'name', 'phone', 'Nickname', 'street', 'unit', 'city', 'zip', 'home_type', 'bed', 'bath', 'king', 'queen', 'full', 'twin', 'enter', 'trash', 'instructions', 'parking', 'restocking', 'payment']

= CSV.generate_line headers
- @transactions.each do |transaction|
  = CSV.generate_line([if transaction.then(:properties) then nil else transaction.id end, transaction.then(:properties) && transaction.properties[0].id || transaction.property.id, transaction.status, if transaction.then(:properties) then nil else transaction.linen_handling end, if transaction.then(:properties) then transaction.amount / 100 else transaction.cost end, if transaction.then(:properties) then transaction.amount / 100 else transaction.prediscount_cost end, if transaction.then(:properties) then transaction.amount / 100 else transaction.adjusted_cost / 100 end, if transaction.then(:properties) then nil else transaction.cleaning_cost end, if transaction.then(:properties) then nil else transaction.linen_cost end, if transaction.then(:properties) then nil else transaction.toiletries_cost end, if transaction.then(:properties) then nil else transaction.pool_cost end, if transaction.then(:properties) then nil else transaction.patio_cost end, if transaction.then(:properties) then nil else transaction.windows_cost end, if transaction.then(:properties) then nil else transaction.staging_cost end, if transaction.then(:properties) then nil else transaction.late_next_day_cost end, if transaction.then(:properties) then nil else transaction.late_same_day_cost end, if transaction.then(:properties) then nil else transaction.no_access_fee_cost end, if transaction.then(:properties) then nil else transaction.extra_king_sets_cost end, if transaction.then(:properties) then nil else transaction.extra_twin_sets_cost end, if transaction.then(:properties) then nil else transaction.extra_toiletry_sets_cost end, if transaction.then(:properties) then nil else "-#{transaction.first_booking_discount_cost}" end, if transaction.then(:properties) then nil else "-#{transaction.coupon_dollar_cost}" end, transaction.then(:properties) && 'Received' || transaction.payment_status_cd == 0 && 'Open' || 'Received', transaction.then(:properties) && transaction.properties[0].user.email || transaction.property.user.email, transaction.then(:properties) && transaction.properties[0].user.id || transaction.property.user.id, (transaction.then(:date) || transaction.charged_at).strftime('%m/%d/%Y (%A)'), transaction.then(:properties) && transaction.properties[0].user.name || transaction.property.user.name, transaction.then(:properties) && transaction.properties[0].user.phone_number || transaction.property.user.phone_number, transaction.then(:properties) && transaction.properties[0].nickname || transaction.property.nickname, transaction.then(:properties) && transaction.properties[0].address1 || transaction.property.address1, if transaction.then(:properties) then transaction.properties[0].address2 else transaction.property.address2 end, transaction.then(:properties) && transaction.properties[0].city || transaction.property.city, transaction.then(:properties) && transaction.properties[0].zip || transaction.property.zip, transaction.then(:properties) && transaction.properties[0].property_type_cd == 0 && 'house' || 'condo' || transaction.property.property_type_cd == 0 && 'house' || 'condo', transaction.then(:properties) && transaction.properties[0].bedrooms || transaction.property.bedrooms, transaction.then(:properties) && transaction.properties[0].bathrooms || transaction.property.bathrooms, transaction.then(:properties) && transaction.properties[0].king_beds || transaction.property.king_beds, transaction.then(:properties) && transaction.properties[0].queen_beds || transaction.property.queen_beds, transaction.then(:properties) && transaction.properties[0].full_beds ||transaction.property.full_beds, transaction.then(:properties) && transaction.properties[0].twin_beds || transaction.property.twin_beds, transaction.then(:properties) && transaction.properties[0].access_info || transaction.property.access_info, transaction.then(:properties) && transaction.properties[0].trash_disposal || transaction.property.trash_disposal, transaction.then(:properties) && transaction.properties[0].additional_info || transaction.property.additional_info, transaction.then(:properties) && transaction.properties[0].parking_info || transaction.property.parking_info, transaction.then(:properties) && transaction.properties[0].restocking_info || transaction.property.restocking_info, if transaction.then(:properties) then transaction.properties[0].user.primary_payment.display else transaction.payment.display end]).html_safe