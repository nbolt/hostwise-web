general:
  branches:
    only:
      - master
      - develop

dependencies:
  pre:
    - npm install phantomjs
    - npm install protractor
    - ./node_modules/protractor/bin/webdriver-manager update

test:
  override:
    - bundle exec rake test
    - RAILS_ENV=test bundle exec rails s:
      background: true
    - bundle exec rake test:e2e

deployment:
  staging:
    branch: develop
    commands:
      - git push git@heroku.com:hostwise-staging.git $CIRCLE_SHA1:master
      - heroku run rake db:migrate --app hostwise-staging
      - heroku restart --app hostwise-staging
  production:
    branch: master
    commands:
       - git push git@heroku.com:hostwise.git $CIRCLE_SHA1:master
       - heroku run rake db:migrate --app hostwise
       - heroku restart --app hostwise
